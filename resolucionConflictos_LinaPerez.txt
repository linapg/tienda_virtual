Conflictos de Git merge

Los sistemas de control de versiones consisten en gestionar las contribuciones de diversos autores distribuidos (normalmente, desarrolladores). A veces, se puede dar el caso de que varios desarrolladores intenten editar el mismo contenido. Si el desarrollador A intenta editar c贸digo que el desarrollador B est谩 editando, podr铆a producirse un conflicto. Para evitar que se produzcan conflictos, los desarrolladores trabajan en ramas aisladas independientes. La funci贸n principal del comando git merge es combinar ramas independientes y resolver los cambios en conflicto.

An谩lisis de los conflictos de fusi贸n
La fusi贸n y los conflictos son una parte com煤n de la experiencia de Git. Los conflictos en otras herramientas de control de versiones como SVN pueden ser costosos y hacernos perder mucho tiempo. Con Git, la fusi贸n es coser y cantar. La mayor parte del tiempo Git se las ingeniar谩 para integrar autom谩ticamente los nuevos cambios.

Normalmente los conflictos surgen cuando dos personas han cambiado las mismas l铆neas de un archivo o si un desarrollador ha eliminado un archivo mientras otro lo estaba modificando. En estos casos, Git no puede determinar autom谩ticamente qu茅 es correcto. Los conflictos solo afectan al desarrollador que realiza la fusi贸n, el resto del equipo no se entera del conflicto. Git marcar谩 el archivo como que tiene un conflicto y detendr谩 el proceso de fusi贸n. Entonces el desarrollador es el responsable de resolver el conflicto.

Tipos de conflictos de fusi贸n
Una fusi贸n puede entrar en un estado conflictivo en dos momentos diferentes. Al inicio y durante un proceso de fusi贸n. A continuaci贸n, se explica c贸mo abordar cada uno de estos escenarios de conflicto.

Git no inicia la fusi贸n
Una fusi贸n no se iniciar谩 si Git detecta que hay cambios en el directorio de trabajo o el entorno de ensayo del proyecto actual. Git no inicia la fusi贸n porque las confirmaciones que se est谩n fusionando podr铆an sobrescribir estos cambios pendientes. Cuando esto sucede, no se debe a conflictos con otros desarrolladores, sino con cambios locales pendientes. El estado local tendr谩 que estabilizarse mediante git stash, git checkout, git commit o git reset. Un fallo de fusi贸n durante el inicio provocar谩 que aparezca el siguiente mensaje de error:

error: Entry '<fileName>' not uptodate. Cannot merge. (Changes in working directory)
Git falla durante la fusi贸n
Un fallo DURANTE una fusi贸n indica un conflicto entre la rama local actual y la rama que se est谩 fusionando. Esto indica un conflicto con el c贸digo de otro desarrollador. Git har谩 lo posible para fusionar los archivos, pero te dejar谩 cosas para que las resuelvas manualmente en los archivos con conflictos. Un fallo a la mitad de la fusi贸n provocar谩 que aparezca el siguiente mensaje de error:

error: Entry '<fileName>' would be overwritten by merge. Cannot merge. (Changes in staging area)
Creaci贸n de un conflicto de fusi贸n
Para familiarizarte de verdad con los conflictos de fusi贸n, en la siguiente secci贸n se simular谩 un conflicto para examinarlo y resolverlo posteriormente. Para el ejemplo, se utilizar谩 una interfaz Git de l铆nea de comandos similar a Unix para ejecutar la simulaci贸n del ejemplo.

$ mkdir git-merge-test
$ cd git-merge-test
$ git init .
$ echo "this is some content to mess with" > merge.txt
$ git add merge.txt
$ git commit -am"we are commiting the inital content"
[main (root-commit) d48e74c] we are commiting the inital content
1 file changed, 1 insertion(+)
create mode 100644 merge.txt
Este ejemplo de c贸digo ejecuta una secuencia de comandos que realiza lo siguiente.

Crear un nuevo directorio llamado git-merge-test, cambiar a ese directorio e inicializarlo como nuevo repositorio de Git.
Crear un nuevo archivo de texto merge.txt con algo de contenido en 茅l.
A帽adir merge.txt al repositorio y confirmarlo.
Ahora tenemos un nuevo repositorio con una sola rama main y un archivo merge.txt con contenido. A continuaci贸n, crearemos una nueva rama y la utilizaremos para crear una fusi贸n conflictiva.

$ git checkout -b new_branch_to_merge_later
$ echo "totally different content to merge later" > merge.txt
$ git commit -am"edited the content of merge.txt to cause a conflict"
[new_branch_to_merge_later 6282319] edited the content of merge.txt to cause a conflict
1 file changed, 1 insertion(+), 1 deletion(-)
La siguiente secuencia de comandos logra lo siguiente:

Crear y extraer una nueva rama llamada new_branch_to_merge_later.
Sobrescribir el contenido de merge.txt.
Confirmar el nuevo contenido.
Con esta nueva rama new_branch_to_merge_later, hemos creado una confirmaci贸n que sobrescribe el contenido de merge.txt.

git checkout main
Switched to branch 'main'
echo "content to append" >> merge.txt
git commit -am"appended content to merge.txt"
[main 24fbe3c] appended content to merge.tx
1 file changed, 1 insertion(+)
Esta cadena de comandos extrae la rama main, a帽ade contenido a merge.txt y lo confirma. Esto ahora pone nuestro repositorio de ejemplo en un estado en el que tenemos 2 nuevas confirmaciones. Una est谩 en la rama main y la otra en la rama new_branch_to_merge_later. En este momento, vamos a usar git merge new_branch_to_merge_later y a ver qu茅 pasa.

$ git merge new_branch_to_merge_later
Auto-merging merge.txt
CONFLICT (content): Merge conflict in merge.txt
Automatic merge failed; fix conflicts and then commit the result.
隆BUM!  Surge un conflicto. 隆Gracias por avisarnos, Git!

C贸mo identificar conflictos de fusi贸n
Tal y como hemos comprobado en el ejemplo anterior, Git generar谩 un resultado descriptivo para indicarnos que se ha producido un conflicto (CONFLICT). Podemos sacar m谩s informaci贸n ejecutando el comando git status.

$ git status
On branch main
You have unmerged paths.
(fix conflicts and run "git commit")
(use "git merge --abort" to abort the merge)

Unmerged paths:
(use "git add <file>..." to mark resolution)

both modified:   merge.txt
El resultado de git status indica que hay rutas sin fusionar debido a un conflicto. El archivo merge.text ahora aparece con el estado modificado. Vamos a examinar el archivo y ver lo que se ha modificado.

$ cat merge.txt
<<<<<<< HEAD
this is some content to mess with
content to append
=======
totally different content to merge later
>>>>>>> new_branch_to_merge_later
Aqu铆 hemos usado el comando cat para mostrar el contenido del archivo merge.txt. Podemos ver algunas nuevas adiciones extra帽as:

<<<<<<< HEAD
=======
>>>>>>> new_branch_to_merge_later
Considera estas nuevas l铆neas como "l铆neas divisorias de conflictos". La l铆nea ======= es el "centro" del conflicto. Todo el contenido entre el centro y la l铆nea <<<<<<< HEAD es contenido que existe en la rama principal actual a la que apunta la referencia HEAD. Por el contrario, todo el contenido entre el centro y >>>>>>> new_branch_to_merge_later es contenido que est谩 presente en nuestra rama de fusi贸n.

C贸mo resolver conflictos de fusi贸n mediante la l铆nea de comandos
La forma m谩s directa de resolver un conflicto de fusi贸n es editar el archivo conflictivo. Abre el archivo merge.txt en el editor que prefieras. Para nuestro ejemplo, simplemente vamos a eliminar todas las l铆neas divisorias de conflictos. El contenido de merge.txt modificado tendr谩 entonces este aspecto:

this is some content to mess with
content to append
totally different content to merge later
Cuando hayas editado el archivo, utiliza git add merge.txt para preparar el nuevo contenido fusionado. Para finalizar la fusi贸n, crea una nueva confirmaci贸n ejecutando lo siguiente:

git commit -m "merged and resolved the conflict in merge.txt"
Git ver谩 que se ha resuelto el conflicto y crea una nueva confirmaci贸n de fusi贸n para finalizar la fusi贸n.

Comandos de Git que pueden ayudar a resolver los conflictos de fusi贸n
Herramientas generales
git status
El comando status se utiliza frecuentemente cuando se trabaja con Git y durante una fusi贸n ayudar谩 a identificar los archivos con conflictos.

git log --merge
Al pasar el argumento --merge al comando git log, se crear谩 un registro con una lista de confirmaciones que entran en conflicto entre las ramas que se van a fusionar.

git diff
diff ayuda a encontrar diferencias entre los estados de un repositorio/unos archivos. Esto es 煤til para predecir y evitar conflictos de fusi贸n.

Herramientas para cuando git no puede iniciar una fusi贸n
git checkout
checkout puede utilizarse para deshacer cambios en los archivos o para cambiar ramas.

git reset --mixed
reset puede utilizarse para deshacer cambios en el directorio de trabajo y el entorno de ensayo.

Herramientas para cuando surgen conflictos de git durante una fusi贸n
git merge --abort
Si se ejecuta git merge con la opci贸n --abort, se saldr谩 del proceso de fusi贸n y volver谩 a poner la rama en el estado que ten铆a antes de que empezara la fusi贸n.

git reset
Git reset puede utilizarse durante un conflicto de fusi贸n para restablecer los archivos conflictivos a un estado que se sabe que es adecuado.

Resumen
Los conflictos de fusi贸n pueden ser una experiencia intimidatoria. Por suerte, Git ofrece herramientas potentes para ayudar a navegar y resolver conflictos. Git puede ocuparse de la mayor铆a de las fusiones por s铆 mismo con funciones de fusi贸n autom谩ticas. Surge un conflicto cuando dos ramas independientes han editado la misma l铆nea de un archivo o cuando un archivo se ha eliminado en una rama, pero editado en la otra. Lo m谩s probable es que los conflictos se produzcan cuando se trabaja en un entorno de equipo.

*Fuente: Atlassian Bitbucket. Link: https://www.atlassian.com/es/git/tutorials/using-branches/merge-conflicts
